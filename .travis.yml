language: objective-c
os: osx
osx_image: xcode12.5

jobs:
  include:
    - stage: Linting
      name: SwiftLint
      addons:
        homebrew:
          packages:
          - swiftlint
          update: true
      script:
      - swiftlint
    - stage: Unit Tests
      name: iOS
      script:
      - set -o pipefail && xcodebuild -project okta-oidc.xcodeproj -scheme "okta-oidc-ios" -destination "platform=iOS Simulator,OS=latest,name=iPhone 11" clean test | xcpretty
    - stage: Unit Tests
      name: MacOS
      script:
      - set -o pipefail && xcodebuild -project okta-oidc.xcodeproj -scheme "okta-oidc-mac" -destination "platform=macOS" clean test | xcpretty
    - stage: UI tests
      name: iOS
      script:
      - set -o pipefail && xcodebuild -project okta-oidc.xcodeproj -scheme "okta-oidc" -destination "platform=iOS Simulator,OS=latest,name=iPhone 11" clean test | xcpretty
    - stage: Dependency Manager Validation
      name: SPM
      script:
      - swift test
    - stage: Dependency Manager Validation
      name: CocoaPods
      script:
      - pod lib lint --allow-warnings
    # Takes too much time on CI
    # - stage: Dependency Manager Validation
    #   name: Carthage
    #   addons:
    #     homebrew:
    #       packages:
    #       - carthage
    #       update: true
    #   script:
    #   - carthage build --use-xcframeworks --no-skip-current
